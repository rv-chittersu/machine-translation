# Neural Machine Translation with Attention Mechanism
This work is done as part of [assignment](https://sites.google.com/site/2019e1246/schedule/assignment-2) 
for [E1 246: Natural Language Understanding (2019)](https://sites.google.com/site/2019e1246/basics). The report for the same can be found [here](https://github.com/rv-chittersu/word2vec/blob/master/report.pdf)


## File Structure
Project layout
```
data/
- proc.train.tsv
- pros.dev.tsv
- proc.test.tsv
- train.tsv
- dev.tsv
- test.tsv
- en.vocab
- de.vocab
results/
Readme.md
attention_handler.py
config.ini
config_handler.py
decoder.py
driver.py
encoder.py
preprocessing.py
requirements.txt
training_handler.py
utils.py
report.pdf
```

### Data

The folder contains sample **train.tsv, dev.tsv and test.tsv** contains representation of sentences in English and German seperated by <Tab>.<br>
The datasets are generated from generated from WMT14 [English-German Europarl  corpus](http://www.statmt.org/wmt14/translation-task.html) <br>

**proc.train.tsv, proc.dev.tsv and proc.test.tsv** are generated from **train.tsv, dev.tsv and test.tsv** respectively. They have sentences represented in encoded form which can be directly fed to model. 

The encodings in the above file is generated based on **en.vocab, de.vocab** which is built using **train.tsv**

*Note:* New training splits and vocabulary can be generated from *preprocessing.py*

### Code

**config_handler.py** acts as interface between *config.ini* and the rest of the program.<br>
**utils.py** contains generic utility functions used by rest of the program<br>
**preprocessing.py** is used to generate encoded train, dev and test from parallel corpus. As intermediate steps it generates processed datasets and vocabulary. All the expected input and files should be modified in *config.ini*  <br>
**encoder.py** contains code for encoder layer<br>
**decoder.py** contains code for decoder layer<br>
**attention_handler.py** contains code for various attention types.<br>
**training_handler.py** is used to manage training/validation/testing batch wise<br>
**driver.py** is entry point for the process and manages program life cycle.<br>

### Results


The files generated in a run are stored in *ResultsDirectory* specified in configs file<br> 
The files generated on each run will have unique **key**

The following files will be generated in after training
* encoder and decoder checkpoints at each epoch  **[key].[epoch-no].encoder** and **[key].[epoch-no].decoder** 
* results file(which have concise information of the run) of form **[key].results.txt**
* output file generated by test data **[key].test.res**

## Config File
Contains all adjustable parameters settings for program to run. The whole code doesn't take any additional parameters. So for functionality always keep config file consistent.
<details>
<summary>
[Format of the Config file]
</summary>

```
[DATA]
SourceData = ./en.de/data.en
DestinationData = ./en.de/data.de

ProcessedTrainingData = ./en.de/proc.train.tsv
ProcessedDevData = ./en.de/proc.dev.tsv
ProcessedTestData = ./en.de/proc.test.tsv

TrainingData = ./en.de/train1.tsv
DevData = ./en.de/dev1.tsv
TestData = ./en.de/test1.tsv

SourceLang = en
DestinationLang = de

SourceVocab = ./en.de/en.vocab
DestinationVocab = ./en.de/de.vocab
MinimumFrequency = 25

ResultDir = ./results

[MODEL]
LSTMHiddenUnits = 120
LSTMLayers = 2
SourceEmbeddingDim = 120
DestinationEmbeddingDim = 120
LearningRate = 0.1
MaxDecodeLength = 25

[ATTENTION]
Name = additive
DecoderAttn = True
KVSplit = 60,60

[TRAINING]
BatchSize = 100
Epochs = 3
MaxBatches = 500
```

</details>

## How to Run

create a python3 virtual environment.<br>
In the virtual environment run following to install required packages

```bash
pip3 install -r requirements.txt
```

### Run on available dataset
verify that files in config are present and run following commands from project folder
```
python driver.py
``` 

### Generate new training split
update *DATA* section of *config.ini* with required information.<br>

*param1* - training set size (optional)<br>
```
* python preprocessing.py 
```

and run
```
python driver.py
```


## Evaluation